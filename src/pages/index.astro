---
import Layout from '~/layouts/Layout.astro';
import SiteHeader from '~/components/SiteHeader.astro';
import { Icon } from 'astro-icon/components';
import { fetchPosts } from '~/utils/blog';
import { getPermalink } from '~/utils/permalinks';
import { getFormattedDate } from '~/utils/utils';

const metadata = {
  title: 'Djaygo - Digital Garden',
  ignoreTitleTemplate: true,
};

const posts = await fetchPosts();
---

<Layout metadata={metadata}>
  <main>
    <section class="px-4 sm:px-6 py-12 sm:py-16 lg:py-20 mx-auto max-w-3xl min-h-screen">
      <SiteHeader />

      <!-- Timeline -->
      <div class="relative stagger-fade-in">
        <!-- Timeline line -->
        <div class="absolute left-4 top-0 bottom-0 w-px bg-gradient-to-b from-primary/50 via-gray-200 to-gray-200 dark:via-slate-700 dark:to-slate-700"></div>

        {posts.map((post) => (
          <a
            href={getPermalink(post.slug, 'post')}
            class="group block relative pl-12 pb-8 last:pb-0"
          >
            <!-- Timeline dot -->
            <div class="absolute left-0 w-8 h-8 rounded-full bg-white dark:bg-slate-900 border-2 border-gray-200 dark:border-slate-700 group-hover:border-primary group-hover:scale-110 dark:group-hover:border-primary flex items-center justify-center transition-all duration-300">
              <Icon name="tabler:note" class="w-4 h-4 text-muted group-hover:text-primary transition-colors" />
            </div>

            <!-- Content -->
            <div class="card">
              <time class="text-xs text-muted" datetime={String(post.publishDate)}>
                {getFormattedDate(post.publishDate)}
              </time>
              <h2 class="text-lg font-semibold mt-1 group-hover:text-primary transition-colors">
                {post.title}
              </h2>
              {post.excerpt && (
                <p class="text-sm text-muted mt-2 line-clamp-2">
                  {post.excerpt}
                </p>
              )}
              {post.tags && post.tags.length > 0 && (
                <div class="flex flex-wrap gap-2 mt-3">
                  {post.tags.slice(0, 3).map((tag) => (
                    <span class="text-xs px-2 py-0.5 rounded-full bg-gray-200 dark:bg-slate-700 text-muted transition-colors group-hover:bg-primary/10">
                      #{tag.slug || tag}
                    </span>
                  ))}
                </div>
              )}
            </div>
          </a>
        ))}

        {posts.length === 0 && (
          <p class="text-center text-muted py-8">
            No notes yet. The garden is just getting started.
          </p>
        )}
      </div>
    </section>
  </main>
</Layout>

<style>
  .card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 30px;
    border-radius: 20px;
    text-align: left;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    transition: 0.3s ease;
    z-index: 2;
  }

  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
  }
</style>
