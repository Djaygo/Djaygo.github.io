---
import Layout from '~/layouts/PageLayout.astro';
import { Icon } from 'astro-icon/components';
import { getPermalink } from '~/utils/permalinks';
import { fetchPosts } from '~/utils/blog';

const metadata = {
  title: 'Tags',
};

const posts = await fetchPosts();

// Extract all tags and count them
const tagCounts: Record<string, number> = {};
posts.forEach((post) => {
  post.tags?.forEach((tag) => {
    const tagSlug = tag.slug || tag;
    if (!tagCounts[tagSlug]) {
      tagCounts[tagSlug] = 0;
    }
    tagCounts[tagSlug]++;
  });
});

// Sort tags by count
const sortedTags = Object.entries(tagCounts).sort((a, b) => b[1] - a[1]);
---

<Layout metadata={metadata}>
  <div>
    <h2 class="text-2xl font-bold mb-2">Browse by Tags</h2>
    <p class="text-muted mb-8">Tags help connect related notes. Click any tag to explore that topic.</p>

    <div class="flex flex-wrap gap-3">
      {
        sortedTags.map(([tag, count]) => (
          <a
            href={getPermalink(tag, 'tag')}
            class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm hover:bg-primary hover:text-white dark:hover:bg-primary transition-colors duration-200 shadow-sm"
          >
            <Icon name="tabler:hash" class="w-4 h-4" />
            <span>{tag}</span>
            <span class="text-xs bg-gray-200 dark:bg-slate-700 px-2 py-0.5 rounded-full">{count}</span>
          </a>
        ))
      }
    </div>

    {
      sortedTags.length === 0 && (
        <p class="text-center text-muted py-8">No tags yet. Start adding notes with tags!</p>
      )
    }
  </div>
</Layout>
